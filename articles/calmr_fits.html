<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="calmr">
<title>calmr_fits • calmr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="calmr_fits">
<meta property="og:description" content="calmr">
<meta property="og:image" content="https://victornavarro.org/calmr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">calmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/PKH1982_math.html">PKH1982_math</a>
    <a class="dropdown-item" href="../articles/RW1972_math.html">RW1972_math</a>
    <a class="dropdown-item" href="../articles/SM2007_math.html">SM2007_math</a>
    <a class="dropdown-item" href="../articles/SM2007_sims.html">SM2007_sims</a>
    <a class="dropdown-item" href="../articles/calmr_app.html">calmr_app</a>
    <a class="dropdown-item" href="../articles/calmr_basics.html">calmr_basics</a>
    <a class="dropdown-item" href="../articles/calmr_fits.html">calmr_fits</a>
    <a class="dropdown-item" href="../articles/heidi_math.html">heidi_math</a>
    <a class="dropdown-item" href="../articles/heidi_similarity.html">heidi_similarity</a>
    <a class="dropdown-item" href="../articles/mac1975_math.html">MAC1975_math</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/victor-navarro/calmr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>calmr_fits</h1>
                        <h4 data-toc-skip class="author">Victor
Navarro</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/victor-navarro/calmr/blob/HEAD/vignettes/calmr_fits.Rmd" class="external-link"><code>vignettes/calmr_fits.Rmd</code></a></small>
      <div class="d-none name"><code>calmr_fits.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/victor-navarro/calmr" class="external-link">calmr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pati</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="fitting-heidi-to-empirical-data">Fitting HeiDI to empirical data<a class="anchor" aria-label="anchor" href="#fitting-heidi-to-empirical-data"></a>
</h2>
<p>In this demo, I fit HeiDI to some empirical data (Patitucci et al.,
2016, Experiment 1). This will involve writing a function that produces
model responses organized as the empirical data, and using that function
for maximum likelihood estimation (MLE). We begin with a short overview
of the data, then move to the model function, and finally fit the
model.</p>
<div class="section level3">
<h3 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h3>
<p>The data (<code>pati</code>) contains the responses (lever presses or
lp, and nose pokes or np) for 32 subjects (rats) across 6 blocks of
training (2 sessions per block). The animals were trained to associate
each of two levers to one of two unconditioned stimuli (pellets or
sucrose). Let’s take a look at it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">pati</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 768</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ subject  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span><span class="co">#&gt; $ block    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3…</span></span>
<span><span class="co">#&gt; $ lever    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> L, L, L, L, L, L, R, R, R, R, R, R, L, L, L, L, L, L, R, R, R…</span></span>
<span><span class="co">#&gt; $ us       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P", "P", "P", "P", "P", "P", "S", "S", "S", "S", "S", "S", "…</span></span>
<span><span class="co">#&gt; $ response <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> lp, lp, lp, lp, lp, lp, lp, lp, lp, lp, lp, lp, np, np, np, n…</span></span>
<span><span class="co">#&gt; $ rpert    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9000, 1.5500, 3.3500, 4.1500, 4.6500, 4.3250, 0.4000, 0.162…</span></span>
<span><span class="va">pati</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">block</span>, y <span class="op">=</span> <span class="va">rpert</span>, colour <span class="op">=</span> <span class="va">us</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">us</span>, <span class="va">subject</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Block"</span>, y <span class="op">=</span> <span class="st">"Responses per trial"</span>, colour <span class="op">=</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">response</span><span class="op">)</span></span></code></pre></div>
<p><img src="calmr_fits_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>The thicker lines are group averages; the rest are individual
subjects. We ignore the specific mapping between levers and USs here,
because that was counterbalanced across subjects. However, the
counterbalancing will end up being relevant (see ahead).</p>
</div>
<div class="section level3">
<h3 id="writing-the-model-function">Writing the model function<a class="anchor" aria-label="anchor" href="#writing-the-model-function"></a>
</h3>
<p>The biggest hurdle in fitting the model to empirical data is to write
a function that, given a vector of parameters and model arguments,
generates responses that are organized as the empirical data. Let’s
begin by summarizing the group data first, so we know what to aim
for.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pati_summ</span> <span class="op">&lt;-</span> <span class="va">pati</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">us</span>, <span class="va">response</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>rpert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rpert</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pati_summ</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   block us    response rpert</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 P     lp       0.820</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 P     np       3.41 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     1 S     lp       0.561</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     1 S     np       3.28 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     2 P     lp       1.57 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     2 P     np       3.51</span></span></code></pre></div>
<p>We now prepare the arguments for the model function (as you would
pass to <code>run_experiment</code>experiment.</p>
<p>This is no minor issue, because the HeiDI is sensitive to order
effects. Hence, it is important that the arguments we prepare here
reflect the behavior of the model after an “general” experimental
procedure, and not the quirks of an unfortunate run of tials. Here, we
simply address this issue by running several iterations of the model
(with random trial orders) and average all models before evaluating the
likelihood of the parameters.</p>
<p>So what do we have to design? The experiment presented in Patittuci
et al. (2016) was fairly simple, and it can be reduced to the
presentations of two levers, each followed by a different appetitive
outcome. Here, we will assume that the two outcomes are independent from
each other. We will also take some liberties with the number of trials
we specify, in order to reduce computing time.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The design data.frame</span></span>
<span><span class="va">des_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CB1"</span>, <span class="st">"CB2"</span><span class="op">)</span>,</span>
<span>  training <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"12L&gt;(Pellet)/12R&gt;(Sucrose)"</span>,</span>
<span>    <span class="st">"12L&gt;(Sucrose)/12R&gt;(Pellet)"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  rand_train <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># The parameters</span></span>
<span><span class="co"># the actual parameter values don't matter,</span></span>
<span><span class="co"># as our function will re-write them inside the optimizer call</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="va">des_df</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"HD2022"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># The options</span></span>
<span><span class="va">options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_exp_opts.html">get_exp_opts</a></span><span class="op">(</span>iterations <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># The arguments</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_experiment.html">make_experiment</a></span><span class="op">(</span><span class="va">des_df</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">parameters</span>, model <span class="op">=</span> <span class="st">"HD2022"</span>,</span>
<span>  options <span class="op">=</span> <span class="va">options</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note we specified two counterbalancings as groups. It is very
important that we reproduce the counterbalancings in the data we are
trying to fit as close as possible. Otherwise, the optimization process
might latch onto experimentally-irrelevant variables. For example, it
can be seen in <code>pati</code> that there was more lever pressing
whenever a lever was paired with pellets. If we didn’t counterbalance
the identities of the levers and USs, the optimization might result into
one of the levers being less salient than the other.</p>
<p>We can now begin to write the model function. First, it would be a
good idea to see what results <code>run_experiment</code> returns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/results.html">results</a></span><span class="op">(</span><span class="va">exp_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; $as</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 352 × 8</span></span></span>
<span><span class="co">#&gt;    model  group trial trial_type phase    s1    block_size value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> HD2022 CB1       1 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> HD2022 CB1       2 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> HD2022 CB1       3 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> HD2022 CB1       4 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> HD2022 CB1       5 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HD2022 CB1       6 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HD2022 CB1       7 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> HD2022 CB1       8 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> HD2022 CB1       9 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HD2022 CB1      10 L&gt;(Pellet) training L              2   0.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 342 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $acts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 704 × 10</span></span></span>
<span><span class="co">#&gt;    model  group trial trial_type phase    s1    s2    block_size type    value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> HD2022 CB1       1 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> HD2022 CB1       2 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> HD2022 CB1       3 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> HD2022 CB1       4 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> HD2022 CB1       5 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HD2022 CB1       6 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HD2022 CB1       7 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> HD2022 CB1       8 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> HD2022 CB1       9 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HD2022 CB1      10 L&gt;(Pellet) training L     L              2 chainvs     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 694 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rs</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,408 × 9</span></span></span>
<span><span class="co">#&gt;    model  group trial trial_type phase    s1    s2    block_size value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> HD2022 CB1       1 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> HD2022 CB1       2 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> HD2022 CB1       3 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> HD2022 CB1       4 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> HD2022 CB1       5 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HD2022 CB1       6 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HD2022 CB1       7 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> HD2022 CB1       8 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> HD2022 CB1       9 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HD2022 CB1      10 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,398 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vs</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,408 × 9</span></span></span>
<span><span class="co">#&gt;    model  group trial trial_type phase    s1    s2    block_size value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> HD2022 CB1       1 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> HD2022 CB1       2 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> HD2022 CB1       3 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> HD2022 CB1       4 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> HD2022 CB1       5 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> HD2022 CB1       6 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HD2022 CB1       7 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> HD2022 CB1       8 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> HD2022 CB1       9 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HD2022 CB1      10 L&gt;(Pellet) training L     L              2     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,398 more rows</span></span></span></code></pre></div>
<p>Although the <code>run_experiment</code> function returns an S4 class
with many things, we only care about one of them: <code>rs</code> (the
model responses). With them, we can write our model function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">parameters</span>, <span class="va">experiment</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># manipulating parameters</span></span>
<span>  <span class="va">new_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">new_parameters</span><span class="op">$</span><span class="va">alphas</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">parameters</span></span>
<span>  <span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new_parameters</span> <span class="co"># note parameters method</span></span>
<span>  <span class="co"># running the model and selecting rs</span></span>
<span>  <span class="va">exp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span>  <span class="co"># summarizing the model</span></span>
<span>  <span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/results.html">results</a></span><span class="op">(</span><span class="va">exp_res</span><span class="op">)</span><span class="op">$</span><span class="va">rs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">s2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pellet"</span>, <span class="st">"Sucrose"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">s1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pellet"</span>, <span class="st">"Sucrose"</span><span class="op">)</span>, <span class="st">"np"</span>, <span class="st">"lp"</span><span class="op">)</span>,</span>
<span>      block <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">trial</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># note this filter below;</span></span>
<span>    <span class="co"># we do not allow lever presses if the lever was not presented on the trial</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"np"</span> <span class="op">|</span> <span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"lp"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">trial_type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>us <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Pellet"</span>, <span class="va">trial_type</span><span class="op">)</span>, <span class="st">"P"</span>, <span class="st">"S"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">block</span>, <span class="va">us</span>, <span class="va">response</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span>  <span class="va">rs</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s dissect the function above in its three parts.</p>
<ol style="list-style-type: decimal">
<li><p>We put <code>parameters</code> (the optimizer parameters) into
the experiment using the <code>parameters</code> method.</p></li>
<li><p>We run the model and select the relevant information
(rs).</p></li>
<li><p>We summarise the model responses and return them.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Within this step, we also filter all output nodes that
are not related to expecting one of the USs, we classify responses as
being nosepokes (produced by the US) or lever presses (produced by the
levers), and calculate the mean across blocks of trials. Fitting a model
is no trivial task!&lt;/p&gt;"><sup>1</sup></a></p></li>
</ol>
<p>Let’s see the function in action.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">my_model_function</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.3</span><span class="op">)</span>, experiment <span class="op">=</span> <span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.011428571 0.002285714 0.009086538 0.001362981 0.038843875 0.017203182</span></span>
<span><span class="co">#&gt;  [7] 0.032357846 0.010771163 0.051407435 0.033924176 0.040160990 0.020330205</span></span>
<span><span class="co">#&gt; [13] 0.056681369 0.046570589 0.045429885 0.029039503 0.054260267 0.053247701</span></span>
<span><span class="co">#&gt; [19] 0.053023859 0.037343391 0.055989939 0.060631103 0.055036916 0.042556665</span></span></code></pre></div>
<p>The order of the empirical data and model responses must match. I
cannot emphasize this point enough: there is nothing within the fit
function that checks or reorders the data for you. You are the sole
responsible for making sure both of these pieces of data are in the same
order. A simple way would be to print the model results before the
return (see above). Once we have made sure everything is looking good,
we can fit the model.</p>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>We fit models using the <code>fit_model</code> function. This
function requires 4 arguments:</p>
<ol style="list-style-type: decimal">
<li>The (empirical) data</li>
<li>A model function</li>
<li>The arguments with which to run the model function.</li>
<li>The optimizer options.</li>
</ol>
<p>We have done a great job taking care of the first three, so let’s
tackle the last.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_optimizer_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_helpers.html">get_optimizer_opts</a></span><span class="op">(</span></span>
<span>  model_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">alphas</span><span class="op">)</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"ga"</span>,</span>
<span>  ll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  ul <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"normal"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">my_optimizer_opts</span></span>
<span><span class="co">#&gt; $model_pars</span></span>
<span><span class="co">#&gt; [1] "L"       "R"       "Pellet"  "Sucrose"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $optimizer</span></span>
<span><span class="co">#&gt; [1] "ga"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $family</span></span>
<span><span class="co">#&gt; [1] "normal"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $family_pars</span></span>
<span><span class="co">#&gt; [1] "normal_scale"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_pars</span></span>
<span><span class="co">#&gt; [1] "L"            "R"            "Pellet"       "Sucrose"      "normal_scale"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $initial_pars</span></span>
<span><span class="co">#&gt; [1] NA NA NA NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ll</span></span>
<span><span class="co">#&gt;            L            R       Pellet      Sucrose normal_scale </span></span>
<span><span class="co">#&gt;            0            0            0            0            0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ul</span></span>
<span><span class="co">#&gt;            L            R       Pellet      Sucrose normal_scale </span></span>
<span><span class="co">#&gt;            1            1            1            1          100 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $verbose</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The <code>get_optimizer_opts</code> function returns many things:</p>
<ol style="list-style-type: decimal">
<li>model_pars: The name of the model parameters. Here, the name of the
alphas for each stimuli.</li>
<li>ll and ul: The lower and upper limits for the parameter search.
Consider shrinking these to speed up the process.</li>
<li>optimizer: The numerical optimization technique we wish to use
during MLE estimation.</li>
<li>family: The family distribution we assume for our model. In
practice, what you request here will be used to determine the link
function to transform model responses, and the likelihood function used
in the objective function. The normal family here does nothing fancy to
the model responses, and will estimate an extra parameter, scale, which
scales the model responses into the scale of the empirical data. When it
comes to likelihood functions, this family will use the normal density
of the data and model differences.</li>
<li>family_pars: The family-specific parameter being estimated alongside
salience parameters.</li>
<li>verbose: Whether to print parameters and objective function values
as we optimize.</li>
</ol>
<p>You are free to modify these; just make sure the structure of the
list returned by <code>get_optimizer_opts</code> remains the same.</p>
<p>We can also pass extra parameters to the optimizer call we are using
(e.g., the <code>par</code> argument for <code>optim</code>, or
<code>parallel</code> for <code>ga</code>). Here, we fit the model in
parallel with <code>ga</code>, and for only 10 iterations.</p>
<p>And with that, we can fit the model! (be patient if you are following
along)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">the_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">pati_summ</span><span class="op">$</span><span class="va">rpert</span>,</span>
<span>  model_function <span class="op">=</span> <span class="va">my_model_function</span>,</span>
<span>  experiment <span class="op">=</span> <span class="va">experiment</span>,</span>
<span>  optimizer_options <span class="op">=</span> <span class="va">my_optimizer_opts</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>fit_model</code> function returns a lot of information to
track what we put in and what we got out. However, typing the model in
the console will show the MLE parameters we obtained this time and their
negative log likelihood, given the data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">the_fit</span></span>
<span><span class="co">#&gt; Calmr model fit: </span></span>
<span><span class="co">#&gt;   Parameters: </span></span>
<span><span class="co">#&gt;            L            R       Pellet      Sucrose normal_scale </span></span>
<span><span class="co">#&gt;    0.3393293    0.2059405    0.4570155    0.8230219   22.2735919 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  nLogLik: </span></span>
<span><span class="co">#&gt;  50.28647</span></span></code></pre></div>
<p>That’s good and all, but how well does a model run with those
parameters “visually” fit the data? We can obtain the predictions from
the model via the <code>predict</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pati_summ</span><span class="op">$</span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">the_fit</span>, experiment <span class="op">=</span> <span class="va">experiment</span><span class="op">)</span></span>
<span><span class="va">pati_summ</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"data"</span> <span class="op">=</span> <span class="st">"rpert"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prediction"</span>, <span class="st">"data"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">block</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">us</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">us</span> <span class="op">~</span> <span class="va">response</span><span class="op">)</span></span></code></pre></div>
<p><img src="calmr_fits_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>This looks pretty good! Save from some blatant misfits, of course.
Now you know everything you need to fit calmr to your empirical data. Go
forth!</p>
<div class="section level4">
<h4 id="a-final-note">A final note<a class="anchor" aria-label="anchor" href="#a-final-note"></a>
</h4>
<p>This vignette was pre-generated, as I don’t want the user to fit the
model at the time of installation. I will try to keep up with it as the
package develops, but if you spot any inconsistencies, please drop me a
line.</p>
</div>
<div class="section level4">
<h4 id="footnotes">Footnotes<a class="anchor" aria-label="anchor" href="#footnotes"></a>
</h4>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Victor Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
